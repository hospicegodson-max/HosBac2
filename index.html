<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HosBac - Plateforme √âducative</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variables CSS pour le design system */
        :root {
            --deep-blue: #1a237e;
            --light-blue: #283593;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --red: #e53935;
            --white: #ffffff;
            --text-dark: #333333;
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Reset et styles de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--deep-blue) 0%, var(--light-blue) 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Styles pour l'effet Glassmorphism am√©lior√© */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 16px;
            transition: var(--transition);
        }

        .glass:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px 0 rgba(31, 38, 135, 0.5);
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--deep-blue) 0%, var(--light-blue) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .logo {
            font-size: 4.5rem;
            font-weight: bold;
            transform: skew(-10deg);
            margin-bottom: 3rem;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #ffffff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: skew(-10deg) scale(1); }
            100% { transform: skew(-10deg) scale(1.05); }
        }

        .icons-container {
            display: flex;
            gap: 2rem;
        }

        .icon {
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
        }

        .icon:nth-child(1) { animation-delay: 0s; }
        .icon:nth-child(2) { animation-delay: 0.5s; }
        .icon:nth-child(3) { animation-delay: 1s; }
        .icon:nth-child(4) { animation-delay: 1.5s; }
        .icon:nth-child(5) { animation-delay: 2s; }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0) rotate(0deg); 
            }
            50% { 
                transform: translateY(-25px) rotate(5deg); 
            }
        }

        /* Modale d'avertissement */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 2.5rem;
            animation: slideUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px); 
            }
            to { 
                opacity: 1;
                transform: translateY(0); 
            }
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 2rem;
        }

        .modal-content {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 1rem;
            margin-bottom: 1.5rem;
        }

        .modal-content h4 {
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #e3f2fd;
        }

        .modal-content ul {
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .btn {
            padding: 0.9rem 1.8rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-red {
            background-color: var(--red);
            color: var(--white);
        }

        .btn-red:hover {
            background-color: #c62828;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(229, 57, 53, 0.4);
        }

        /* Page de connexion/inscription */
        .auth-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.8s ease;
        }

        .auth-box {
            display: flex;
            width: 100%;
            max-width: 1000px;
            height: 650px;
            overflow: hidden;
            border-radius: 20px;
            animation: slideUp 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .auth-image {
            flex: 1;
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.8) 0%, rgba(40, 53, 147, 0.8) 100%), 
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600"><rect width="400" height="600" fill="%23283294"/><path d="M200,300 Q250,250 300,300 T400,300 L400,600 L0,600 L0,300 Q50,350 100,300 T200,300" fill="%231a237e"/><circle cx="200" cy="250" r="50" fill="%233f51b5"/><path d="M150,400 L250,400 L250,500 L150,500 Z" fill="%233f51b5"/><path d="M170,500 L230,500 L230,550 L170,550 Z" fill="%233f51b5"/></svg>') no-repeat center center;
            background-size: cover;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .student {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 220px;
            height: 320px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><circle cx="50" cy="30" r="20" fill="%23ffccbc"/><path d="M30,70 L70,70 L65,120 L35,120 Z" fill="%234caf50"/><path d="M25,120 L75,120 L70,150 L30,150 Z" fill="%233f51b5"/><path d="M20,70 L30,70 L30,100 L20,100 Z" fill="%234caf50"/><path d="M70,70 L80,70 L80,100 L70,100 Z" fill="%234caf50"/></svg>') no-repeat center bottom;
            background-size: contain;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        .auth-forms {
            flex: 1;
            padding: 2.5rem;
            display: flex;
            flex-direction: column;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 1.2rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            font-size: 1.1rem;
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--red);
            font-weight: bold;
            color: var(--red);
        }

        .auth-form {
            display: none;
            flex: 1;
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }

        .auth-form.active {
            display: flex;
        }

        .form-group {
            margin-bottom: 1.8rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.7rem;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--red);
            box-shadow: 0 0 0 2px rgba(229, 57, 53, 0.2);
        }

        .forgot-password {
            text-align: right;
            margin-bottom: 1.8rem;
            color: var(--white);
            text-decoration: underline;
            cursor: pointer;
            transition: var(--transition);
        }

        .forgot-password:hover {
            color: #bbdefb;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1.2rem 1.8rem;
            border-radius: 8px;
            color: var(--white);
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 350px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.success {
            background-color: rgba(76, 175, 80, 0.9);
        }

        .toast.error {
            background-color: rgba(229, 57, 53, 0.9);
        }

        .toast.info {
            background-color: rgba(33, 150, 243, 0.9);
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            padding: 1.2rem;
            z-index: 1000;
            backdrop-filter: blur(15px);
            background: rgba(26, 35, 126, 0.7);
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo-small {
            font-size: 1.8rem;
            font-weight: bold;
            transform: skew(-10deg);
            background: linear-gradient(45deg, #ffffff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-icons {
            display: flex;
            gap: 1.8rem;
        }

        .nav-icon {
            font-size: 1.6rem;
            cursor: pointer;
            padding: 0.7rem;
            border-radius: 50%;
            transition: var(--transition);
            position: relative;
        }

        .nav-icon:hover, .nav-icon.active {
            background-color: var(--glass-bg);
            transform: translateY(-3px);
        }

        .nav-icon.active::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: var(--red);
            border-radius: 50%;
        }

        /* Contenu principal */
        main {
            padding: 2.5rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .page-title {
            margin-bottom: 2.5rem;
            text-align: center;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ffffff, #bbdefb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Cartes d'√©preuves */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        .card {
            padding: 2rem;
            transition: var(--transition);
            animation: slideUp 0.5s ease;
        }

        .card:hover {
            transform: translateY(-10px);
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.2rem;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .card-author {
            margin-bottom: 1.2rem;
            font-style: italic;
        }

        .card-actions {
            display: flex;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid var(--glass-border);
        }

        .action-icon {
            cursor: pointer;
            padding: 0.7rem;
            border-radius: 50%;
            transition: var(--transition);
            font-size: 1.2rem;
        }

        .action-icon:hover {
            background-color: var(--glass-bg);
            transform: scale(1.2);
        }

        /* √âtat vide */
        .empty-state {
            text-align: center;
            padding: 3rem;
            opacity: 0.7;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        /* Filtres */
        .filters {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            transition: var(--transition);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--red);
        }

        /* Bouton d'ajout */
        .add-btn {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: var(--red);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            z-index: 100;
            animation: pulse 2s infinite alternate;
        }

        .add-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }

        /* Modale d'ajout d'√©preuve */
        .add-modal .modal {
            max-width: 650px;
        }

        .form-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .file-upload {
            border: 2px dashed var(--glass-border);
            border-radius: 8px;
            padding: 2.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--red);
            background: rgba(255, 255, 255, 0.05);
        }

        .file-upload input {
            display: none;
        }

        /* Profil */
        .profile-section {
            margin-bottom: 2.5rem;
        }

        .profile-section h2 {
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            color: #e3f2fd;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.8rem;
            background: linear-gradient(45deg, #ffffff, #bbdefb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Footer */
        footer {
            padding: 2.5rem;
            text-align: center;
            margin-top: 4rem;
            backdrop-filter: blur(10px);
            background: rgba(26, 35, 126, 0.7);
            border-top: 1px solid var(--glass-border);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2.5rem;
            margin: 1.5rem 0;
        }

        .footer-link {
            color: var(--white);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: #bbdefb;
            text-decoration: underline;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .social-link {
            color: var(--white);
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .social-link:hover {
            color: #bbdefb;
            transform: translateY(-3px);
        }

        /* Modale d'√©dition de profil */
        .edit-profile-form {
            max-width: 500px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-box {
                flex-direction: column;
                height: auto;
            }
            
            .auth-image {
                height: 200px;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-icons {
                gap: 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="logo">HosBac</div>
        <div class="icons-container">
            <div class="icon">üìö</div>
            <div class="icon">üñä</div>
            <div class="icon">üéí</div>
            <div class="icon">üéâ</div>
            <div class="icon">üîé</div>
        </div>
    </div>

    <!-- Modale d'avertissement -->
    <div id="warning-modal" class="modal-overlay" style="display: none;">
        <div class="modal glass">
            <h2>Conditions G√©n√©rales d'Utilisation</h2>
            <div class="modal-content">
                <!-- Contenu des CGU -->
                <p>Derni√®re mise √† jour : 26/10/2025</p>
                <p>Bienvenue sur HosBac ! En acc√©dant √† notre site web et en utilisant nos services, vous acceptez d'√™tre li√© par les pr√©sentes Conditions G√©n√©rales d'Utilisation (CGU).</p>

                <h4>1. Objet de la Plateforme</h4>
                <p>HosBac est une plateforme √©ducative con√ßue pour aider les √©l√®ves et √©tudiants (du Coll√®ge au Lyc√©e, classes de 6√®me √† la Terminale, et pr√©parant le BEPC et le BAC) en leur donnant acc√®s √† des √©preuves, examens et corrig√©s. Les utilisateurs peuvent consulter, t√©l√©charger et publier des ressources p√©dagogiques.</p>

                <h4>2. Inscription et Compte Utilisateur</h4>
                <ul>
                    <li><strong>Cr√©ation de compte :</strong> Pour acc√©der √† certaines fonctionnalit√©s (comme les favoris ou la publication), vous devez cr√©er un compte en fournissant des informations exactes (Nom, Pr√©nom, Email, Mot de passe).</li>
                    <li><strong>S√©curit√© :</strong> Vous √™tes responsable de la confidentialit√© de votre mot de passe et de toutes les activit√©s effectu√©es depuis votre compte.</li>
                    <li><strong>√Çge :</strong> Vous devez avoir l'√¢ge l√©gal requis dans votre pays pour cr√©er un compte, ou obtenir l'autorisation de vos parents ou tuteurs l√©gaux.</li>
                </ul>

                <!-- Le reste du contenu des CGU serait ici -->
                <p>...</p>
            </div>
            <button id="accept-cgu" class="btn btn-red">J'ai lu et j'accepte</button>
        </div>
    </div>

    <!-- Page de connexion/inscription -->
    <div id="auth-page" class="auth-container" style="display: none;">
        <div class="auth-box glass">
            <div class="auth-image">
                <div class="student" id="student"></div>
            </div>
            <div class="auth-forms">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Connexion</div>
                    <div class="auth-tab" data-tab="register">Inscription</div>
                </div>
                
                <form id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Mot de passe</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <div class="forgot-password" id="forgot-password">Mot de passe oubli√© ?</div>
                    <button type="submit" class="btn btn-red">Se connecter</button>
                </form>
                
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-firstname">Pr√©nom</label>
                        <input type="text" id="register-firstname" required>
                    </div>
                    <div class="form-group">
                        <label for="register-lastname">Nom</label>
                        <input type="text" id="register-lastname" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Mot de passe</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <button type="submit" class="btn btn-red">S'inscrire</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Application principale (apr√®s connexion) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="glass">
            <div class="nav-container">
                <div class="logo-small">HosBac</div>
                <div class="nav-icons">
                    <div class="nav-icon active" data-section="home"><i class="fas fa-home"></i></div>
                    <div class="nav-icon" data-section="notifications"><i class="fas fa-bell"></i></div>
                    <div class="nav-icon" data-section="exams"><i class="fas fa-file-alt"></i></div>
                    <div class="nav-icon" data-section="search"><i class="fas fa-search"></i></div>
                    <div class="nav-icon" data-section="profile"><i class="fas fa-user"></i></div>
                    <div class="nav-icon admin-only" data-section="admin" style="display: none;"><i class="fas fa-shield-alt"></i></div>
                </div>
            </div>
        </header>

        <!-- Contenu principal -->
        <main>
            <!-- Section Accueil -->
            <section id="home-section" class="section active">
                <h1 class="page-title">√âpreuves R√©centes</h1>
                <div class="cards-grid" id="home-cards">
                    <div class="empty-state glass">
                        <i class="fas fa-file-pdf"></i>
                        <h3>Aucune √©preuve disponible</h3>
                        <p>Les √©preuves approuv√©es appara√Ætront ici</p>
                    </div>
                </div>
            </section>

            <!-- Section Notifications -->
            <section id="notifications-section" class="section">
                <h1 class="page-title">Notifications</h1>
                <div class="notifications-list" id="notifications-list">
                    <div class="empty-state glass">
                        <i class="fas fa-bell-slash"></i>
                        <h3>Aucune notification</h3>
                        <p>Vous serez notifi√© des activit√©s importantes</p>
                    </div>
                </div>
                <div class="notification-actions" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-red" id="mark-all-read">Tout marquer comme lu</button>
                    <button class="btn glass" id="delete-all-notifications">Tout supprimer</button>
                </div>
            </section>

            <!-- Section Examens -->
            <section id="exams-section" class="section">
                <h1 class="page-title">Catalogue des √âpreuves</h1>
                <div class="filters">
                    <select class="filter-select glass" id="filter-class">
                        <option value="">Toutes les classes</option>
                        <option value="6√®me">6√®me</option>
                        <option value="5√®me">5√®me</option>
                        <option value="4√®me">4√®me</option>
                        <option value="3√®me">3√®me</option>
                        <option value="2nde">2nde</option>
                        <option value="1√®re">1√®re</option>
                        <option value="Terminale">Terminale</option>
                    </select>
                    <select class="filter-select glass" id="filter-subject">
                        <option value="">Toutes les mati√®res</option>
                        <option value="Math√©matique">Math√©matique</option>
                        <option value="Fran√ßais">Fran√ßais</option>
                        <option value="SVT">SVT</option>
                        <option value="PCT">PCT</option>
                        <option value="Espagnol">Espagnol</option>
                        <option value="HG">HG</option>
                        <option value="Allemand">Allemand</option>
                        <option value="√âconomie">√âconomie</option>
                        <option value="Anglais">Anglais</option>
                        <option value="Comptabilit√©">Comptabilit√©</option>
                        <option value="T-bad">T-bad</option>
                        <option value="Philo">Philo</option>
                        <option value="Droit">Droit</option>
                    </select>
                    <select class="filter-select glass" id="filter-series">
                        <option value="">Toutes les s√©ries</option>
                        <option value="S√©rie A">S√©rie A</option>
                        <option value="S√©rie C">S√©rie C</option>
                        <option value="S√©rie D">S√©rie D</option>
                        <option value="S√©rie G">S√©rie G</option>
                    </select>
                </div>
                <div class="cards-grid" id="exams-cards">
                    <div class="empty-state glass">
                        <i class="fas fa-book-open"></i>
                        <h3>Aucune √©preuve disponible</h3>
                        <p>Les √©preuves approuv√©es appara√Ætront ici</p>
                    </div>
                </div>
            </section>

            <!-- Section Recherche -->
            <section id="search-section" class="section">
                <h1 class="page-title">Recherche</h1>
                <div class="form-group">
                    <input type="text" id="search-input" placeholder="Rechercher par nom, mati√®re ou classe..." class="glass" style="padding: 1.2rem; font-size: 1.1rem;">
                </div>
                <div class="cards-grid" id="search-results">
                    <div class="empty-state glass">
                        <i class="fas fa-search"></i>
                        <h3>Aucun r√©sultat</h3>
                        <p>Utilisez la barre de recherche pour trouver des √©preuves</p>
                    </div>
                </div>
            </section>

            <!-- Section Profil -->
            <section id="profile-section" class="section">
                <h1 class="page-title">Mon Profil</h1>
                <div class="profile-section">
                    <h2>Informations personnelles</h2>
                    <div class="card glass">
                        <p><strong>Nom :</strong> <span id="profile-name"></span></p>
                        <p><strong>Pr√©nom :</strong> <span id="profile-firstname"></span></p>
                        <p><strong>Email :</strong> <span id="profile-email"></span></p>
                        <button class="btn btn-red" id="edit-profile" style="margin-top: 1.5rem;">Modifier mes informations</button>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h2>Statistiques</h2>
                    <div class="profile-stats">
                        <div class="stat-card glass">
                            <div class="stat-value" id="points-balance">0</div>
                            <div class="stat-label">Points</div>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-value" id="exams-submitted">0</div>
                            <div class="stat-label">√âpreuves soumises</div>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-value" id="downloads-count">0</div>
                            <div class="stat-label">T√©l√©chargements</div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h2>Favoris</h2>
                    <div class="cards-grid" id="favorites-cards">
                        <div class="empty-state glass">
                            <i class="fas fa-heart"></i>
                            <h3>Aucun favori</h3>
                            <p>Les √©preuves que vous ajoutez en favoris appara√Ætront ici</p>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-red" id="logout-btn" style="margin-top: 2rem;">D√©connexion</button>
            </section>

            <!-- Section Admin (visible uniquement pour l'admin) -->
            <section id="admin-section" class="section">
                <h1 class="page-title">Tableau de Bord Administrateur</h1>
                <div class="profile-section">
                    <h2>Statistiques</h2>
                    <div class="profile-stats">
                        <div class="stat-card glass">
                            <div class="stat-value" id="total-users">0</div>
                            <div class="stat-label">Utilisateurs</div>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-value" id="total-exams">0</div>
                            <div class="stat-label">√âpreuves</div>
                        </div>
                        <div class="stat-card glass">
                            <div class="stat-value" id="pending-submissions">0</div>
                            <div class="stat-label">Soumissions en attente</div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h2>Mod√©ration</h2>
                    <div id="pending-submissions-list">
                        <div class="empty-state glass">
                            <i class="fas fa-check-circle"></i>
                            <h3>Aucune soumission en attente</h3>
                            <p>Les nouvelles soumissions d'√©preuves appara√Ætront ici</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bouton d'ajout d'√©preuve -->
        <div class="add-btn" id="add-exam-btn">
            <i class="fas fa-plus"></i>
        </div>

        <!-- Footer -->
        <footer class="glass">
            <div class="footer-content">
                <h3>HosBac</h3>
                <p>Contact : mickaelpcs14@gmail.com | T√©l√©phone : +229 01 98 86 07 52</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/profile.php?id=61579985138308" target="_blank" class="social-link"><i class="fab fa-facebook"></i></a>
                    <a href="https://wa.me/qr/73EC225KOITDD1" target="_blank" class="social-link"><i class="fab fa-whatsapp"></i></a>
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link" id="cgu-link">Conditions G√©n√©rales d'Utilisation</a>
                    <a href="#" class="footer-link" id="privacy-link">Politique de Confidentialit√©</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modale d'ajout d'√©preuve -->
    <div id="add-exam-modal" class="modal-overlay" style="display: none;">
        <div class="modal glass add-modal">
            <h2>Ajouter une √©preuve</h2>
            <form id="add-exam-form">
                <div class="form-group">
                    <label for="exam-subject">Mati√®re *</label>
                    <select id="exam-subject" class="glass" required>
                        <option value="">S√©lectionnez une mati√®re</option>
                        <option value="Math√©matique">Math√©matique</option>
                        <option value="Fran√ßais">Fran√ßais</option>
                        <option value="SVT">SVT</option>
                        <option value="PCT">PCT</option>
                        <option value="Espagnol">Espagnol</option>
                        <option value="HG">HG</option>
                        <option value="Allemand">Allemand</option>
                        <option value="√âconomie">√âconomie</option>
                        <option value="Anglais">Anglais</option>
                        <option value="Comptabilit√©">Comptabilit√©</option>
                        <option value="T-bad">T-bad</option>
                        <option value="Philo">Philo</option>
                        <option value="Droit">Droit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="exam-class">Classe/S√©rie</label>
                    <input type="text" id="exam-class" class="glass">
                </div>
                
                <div class="form-group">
                    <label for="exam-name">Nom de l'√©preuve *</label>
                    <input type="text" id="exam-name" class="glass" required>
                </div>
                
                <div class="form-group">
                    <label>Fichier PDF √âpreuve *</label>
                    <div class="file-upload glass" id="exam-file-upload">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.7;"></i>
                        <p>Cliquez pour s√©lectionner le fichier PDF de l'√©preuve</p>
                        <input type="file" id="exam-file" accept=".pdf" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Fichier PDF Corrig√© (facultatif)</label>
                    <div class="file-upload glass" id="solution-file-upload">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.7;"></i>
                        <p>Cliquez pour s√©lectionner le fichier PDF du corrig√©</p>
                        <input type="file" id="solution-file" accept=".pdf">
                    </div>
                </div>
                
                <div class="form-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn glass" id="cancel-add-exam">Annuler</button>
                    <button type="submit" class="btn btn-red">Soumettre</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modale de confirmation pour le corrig√© -->
    <div id="confirm-corrige-modal" class="modal-overlay" style="display: none;">
        <div class="modal glass">
            <h2>Confirmation</h2>
            <p>Voir ce corrig√© co√ªtera 2 points. Confirmer ?</p>
            <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button class="btn glass" id="cancel-corrige">Annuler</button>
                <button class="btn btn-red" id="confirm-corrige">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Modale de partage -->
    <div id="share-modal" class="modal-overlay" style="display: none;">
        <div class="modal glass">
            <h2>Partager l'√©preuve</h2>
            <div class="form-group">
                <input type="text" id="user-search" placeholder="Rechercher un utilisateur par nom/pr√©nom" class="glass">
            </div>
            <div id="user-search-results">
                <div class="empty-state" style="padding: 2rem; text-align: center; opacity: 0.7;">
                    <p>Aucun utilisateur trouv√©</p>
                </div>
            </div>
            <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button class="btn glass" id="cancel-share">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modale d'√©dition de profil -->
    <div id="edit-profile-modal" class="modal-overlay" style="display: none;">
        <div class="modal glass edit-profile-form">
            <h2>Modifier mes informations</h2>
            <form id="edit-profile-form">
                <div class="form-group">
                    <label for="edit-firstname">Pr√©nom</label>
                    <input type="text" id="edit-firstname" class="glass" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-lastname">Nom</label>
                    <input type="text" id="edit-lastname" class="glass" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-email">Email (non modifiable)</label>
                    <input type="email" id="edit-email" class="glass" disabled>
                </div>
                
                <div class="form-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn glass" id="cancel-edit-profile">Annuler</button>
                    <button type="submit" class="btn btn-red">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <!-- Scripts Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Script principal -->
    <script>
        // =================================================================
        // 0. IMPORTATIONS ET CONFIGURATION
        // =================================================================

        // Simuler les importations des modules Firebase (car le HTML utilise les scripts CDN)
        // Dans un projet Next.js r√©el, on utiliserait:
        // import { initializeApp } from 'firebase/app';
        // import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'firebase/auth';
        // ... etc.

        // √âtant donn√© que le HTML utilise les scripts CDN (comme firebasejs/8.10.0/),
        // les objets 'firebase.initializeApp', 'firebase.auth', 'firebase.firestore'
        // et 'firebase.storage' (pour Cloudinary via un proxy si on l'utilisait)
        // sont globalement disponibles.

        document.addEventListener('DOMContentLoaded', () => {

            // üõë REMPLACEZ CECI par votre configuration Firebase r√©elle
            const firebaseConfig = {
                apiKey: "VOTRE_CL√â_API_FIREBASE", // <--- PLACEHOLDER
                authDomain: "hosbac-729f3.firebaseapp.com",
                projectId: "hosbac-729f3",
                storageBucket: "hosbac-729f3.firebasestorage.app",
                messagingSenderId: "577940206427", // <--- PLACEHOLDER (VOTRE SENDER ID)
                appId: "1:577940206427:web:9416d06adb40d28fb3a07e" // <--- PLACEHOLDER (VOTRE APP ID)
            };

            // Configuration Cloudinary (NON-SECR√àTE, utilis√©e c√¥t√© client)
            const cloudinaryConfig = {
                cloudName: "dvlvj9zko",
                uploadPreset: "hosbac_pdf_upload" // Doit √™tre UNsigned dans Cloudinary
            };
            const CLOUDINARY_UPLOAD_URL = `https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/upload`;

            // Initialisation Firebase (V8 SDK, comme dans le HTML)
            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // √âtat de l'application
            let currentUserData = null;
            const ADMIN_EMAIL = 'mickaelpcs14@gmail.com';

            // =================================================================
            // 1. UTILITAIRES (TOASTS ET AFFICHAGE)
            // =================================================================

            // Afficher une notification toast
            function showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toast-container') || document.body;
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;

                // Cr√©er le container s'il n'existe pas
                if (!document.getElementById('toast-container')) {
                    const container = document.createElement('div');
                    container.id = 'toast-container';
                    toastContainer.appendChild(container);
                    toastContainer.style.position = 'relative'; // Pour le positionnement du toast
                    container.style.position = 'fixed';
                    container.style.top = '20px';
                    container.style.right = '20px';
                    container.style.zIndex = '10000';
                    toastContainer.appendChild(container);
                }

                document.getElementById('toast-container').appendChild(toast);

                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);

                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }

            // Afficher/Masquer le Header et le Footer
            function toggleApp(show) {
                document.getElementById('auth-page').style.display = show ? 'none' : 'flex';
                document.getElementById('app').style.display = show ? 'block' : 'none';
            }

            // Mettre √† jour les infos du profil
            function updateProfileInfo(userData) {
                if (userData) {
                    document.getElementById('profile-name').textContent = userData.lastName || 'N/A';
                    document.getElementById('profile-firstname').textContent = userData.firstName || 'N/A';
                    document.getElementById('profile-email').textContent = userData.email || 'N/A';
                    document.getElementById('points-balance').textContent = userData.points || 0;
                    document.getElementById('exams-submitted').textContent = userData.examsSubmitted || 0;
                    document.getElementById('downloads-count').textContent = userData.downloadsCount || 0;

                    // Afficher/masquer l'ic√¥ne admin
                    const adminIcon = document.querySelector('.admin-only');
                    if (userData.isAdmin) {
                        adminIcon.style.display = 'block';
                    } else {
                        adminIcon.style.display = 'none';
                    }
                }
            }


            // =================================================================
            // 2. GESTION DE L'AUTHENTIFICATION ET DE L'√âTAT
            // =================================================================

            // V√©rification de l'√©tat d'authentification Firebase
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    // Utilisateur connect√©
                    const userRef = db.collection('users').doc(user.uid);
                    
                    // √âcoute en temps r√©el du document utilisateur (pour les points!)
                    userRef.onSnapshot(doc => {
                        if (doc.exists) {
                            currentUserData = doc.data();
                            currentUserData.uid = user.uid;
                            updateProfileInfo(currentUserData);
                            toggleApp(true); // Afficher l'application

                            // Charger les donn√©es (Accueil, Notifications, etc.)
                            loadUserDependentData(); 

                        } else {
                            // Cr√©er le document utilisateur apr√®s une nouvelle inscription
                            const [firstName, lastName] = user.displayName ? user.displayName.split(' ') : ['Pr√©nom', 'Nom'];
                            const isAdmin = user.email === ADMIN_EMAIL;
                            
                            const newUserData = {
                                email: user.email,
                                firstName: firstName,
                                lastName: lastName,
                                points: 0,
                                examsSubmitted: 0,
                                downloadsCount: 0,
                                isAdmin: isAdmin,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            };
                            
                            userRef.set(newUserData).then(() => {
                                currentUserData = newUserData;
                                currentUserData.uid = user.uid;
                                updateProfileInfo(currentUserData);
                                toggleApp(true);
                            });
                        }
                    }, error => {
                        console.error("Erreur de lecture en temps r√©el de l'utilisateur:", error);
                        showToast("Erreur de synchronisation du profil.", 'error');
                        auth.signOut();
                    });

                } else {
                    // Utilisateur d√©connect√© ou non logg√©
                    currentUserData = null;
                    document.getElementById('auth-page').style.display = 'flex';
                    document.getElementById('app').style.display = 'none';
                    // Afficher le splash screen
                    document.getElementById('splash-screen').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('splash-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('splash-screen').style.display = 'none';
                            document.getElementById('warning-modal').style.display = 'flex';
                        }, 500);
                    }, 400); // Temps r√©duit pour la d√©connexion

                }
            });

            // Initialisation des √©couteurs d'√©v√©nements (d√©clench√©s apr√®s CGU)
            function initializeAuthListeners() {
                // ... (Logique de basculement Connexion/Inscription) ...
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');
                        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                        document.getElementById(`${tabName}-form`).classList.add('active');
                        const student = document.getElementById('student');
                        // Animation de l'√©tudiant
                        student.style.transform = (tabName === 'login') ? 'translateX(-50%)' : 'translateX(-30%)';
                    });
                });

                // Connexion
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;

                    showToast('Connexion en cours...', 'info');
                    signInWithEmailAndPassword(auth, email, password)
                        .catch(error => {
                            showToast(`Erreur de connexion: ${error.message}`, 'error');
                        });
                });

                // Inscription
                document.getElementById('register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const firstname = document.getElementById('register-firstname').value;
                    const lastname = document.getElementById('register-lastname').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    
                    showToast('Cr√©ation de compte en cours...', 'info');
                    createUserWithEmailAndPassword(auth, email, password)
                        .then(userCredential => {
                            // Mettre √† jour le profil pour stocker Nom/Pr√©nom (utilis√© dans onAuthStateChanged)
                            userCredential.user.updateProfile({
                                displayName: `${firstname} ${lastname}`
                            });
                            showToast('Compte cr√©√© avec succ√®s! Connexion automatique.', 'success');
                        })
                        .catch(error => {
                            showToast(`Erreur d'inscription: ${error.message}`, 'error');
                        });
                });

                // Mot de passe oubli√©
                document.getElementById('forgot-password').addEventListener('click', function() {
                    // Impl√©menter l'envoi d'email de r√©initialisation avec Firebase Auth
                    showToast('Veuillez entrer votre email pour recevoir le lien de r√©initialisation.', 'info');
                });
            }

            // =================================================================
            // 3. LOGIQUE D'UPLOAD (CLOUD BINARY ET FIRESTORE)
            // =================================================================

            // Fonction d'upload vers Cloudinary
            async function uploadToCloudinary(file) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', cloudinaryConfig.uploadPreset);

                try {
                    const response = await fetch(CLOUDINARY_UPLOAD_URL, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    if (data.secure_url) {
                        return data.secure_url;
                    } else {
                        throw new Error(data.error ? data.error.message : "Erreur inconnue lors de l'upload Cloudinary.");
                    }
                } catch (error) {
                    console.error("Erreur Cloudinary:", error);
                    throw error;
                }
            }

            // Soumission du formulaire d'ajout d'√©preuve
            document.getElementById('add-exam-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                if (!currentUserData) return showToast("Vous devez √™tre connect√©.", 'error');

                const form = e.target;
                const submitBtn = form.querySelector('button[type="submit"]');

                const subject = document.getElementById('exam-subject').value;
                const className = document.getElementById('exam-class').value;
                const name = document.getElementById('exam-name').value;
                const examFile = document.getElementById('exam-file').files[0];
                const solutionFile = document.getElementById('solution-file').files[0];

                if (!subject || !name || !examFile) {
                    return showToast('Veuillez remplir les champs obligatoires.', 'error');
                }
                
                // D√©sactiver le bouton pour √©viter les doubles soumissions
                submitBtn.disabled = true;
                submitBtn.textContent = 'T√©l√©chargement...';
                showToast('T√©l√©chargement des fichiers en cours...', 'info');

                try {
                    // 1. Upload de l'√©preuve OBLIGATOIRE
                    const examUrl = await uploadToCloudinary(examFile);
                    
                    // 2. Upload du corrig√© FACULTATIF
                    let solutionUrl = null;
                    if (solutionFile) {
                        submitBtn.textContent = 'T√©l√©chargement corrig√©...';
                        solutionUrl = await uploadToCloudinary(solutionFile);
                    }
                    
                    // 3. Sauvegarde dans soumissions_en_attente (Firestore)
                    await db.collection('soumissions_en_attente').add({
                        titre: name,
                        matiere: subject,
                        classe: className,
                        epreuveUrl: examUrl,
                        corrigeUrl: solutionUrl,
                        contributeurId: currentUserData.uid,
                        contributeurNom: `${currentUserData.firstName} ${currentUserData.lastName}`,
                        status: 'pending',
                        hasCorrige: !!solutionFile,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    showToast('Votre √©preuve a √©t√© soumise! En attente de validation.', 'success');
                    form.reset();
                    document.getElementById('add-exam-modal').style.display = 'none';
                    
                    // Mettre √† jour le compteur d'√©preuves soumises dans le profil
                    db.collection('users').doc(currentUserData.uid).update({
                        examsSubmitted: firebase.firestore.FieldValue.increment(1)
                    });

                } catch (error) {
                    showToast(`Erreur lors de la soumission: ${error.message}`, 'error');
                    console.error(error);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Soumettre';
                }
            });

            // =================================================================
            // 4. LOGIQUE DE GAMIFICATION (ACC√àS AU CORRIG√â)
            // =================================================================

            // Fonction pour g√©rer le clic sur "Voir le Corrig√©"
            function handleViewCorrige(examData) {
                if (!examData.corrigeUrl) {
                    return showToast("Ce document n'a pas de corrig√© associ√©.", 'error');
                }
                
                // Si l'utilisateur est le contributeur, l'acc√®s est gratuit
                if (examData.contributeurId === currentUserData.uid) {
                    window.open(examData.corrigeUrl, '_blank');
                    return showToast("Acc√®s gratuit en tant que contributeur.", 'info');
                }

                // Si l'utilisateur a d√©j√† pay√© ou consult√©
                // (Devrait √™tre v√©rifi√© via une sous-collection 'transactions' ou 'acces_corriges')
                // Pour la simplicit√© du front-end, nous allons √† la confirmation:
                
                if (currentUserData.points < 2) {
                    return showToast("Vous n'avez pas assez de points (2 requis).", 'error');
                }
                
                // Ouvrir la modale de confirmation
                pendingCorrigeExam = examData;
                document.getElementById('confirm-corrige-modal').style.display = 'flex';
            }

            // Gestion de la transaction de points (bouton Confirmer dans la modale)
            document.getElementById('confirm-corrige').addEventListener('click', async () => {
                if (!pendingCorrigeExam || !currentUserData) return;

                const exam = pendingCorrigeExam;
                const buyerId = currentUserData.uid;
                const contributorId = exam.contributeurId;

                document.getElementById('confirm-corrige-modal').style.display = 'none';

                if (buyerId === contributorId) {
                    // Cas d√©j√† g√©r√©, ne devrait pas arriver ici
                    window.open(exam.corrigeUrl, '_blank');
                    return;
                }

                try {
                    // üõë NOTE: Une vraie transaction s√©curis√©e DOIT √™tre ex√©cut√©e via une Cloud Function.
                    // Le code ci-dessous est INSEÃÅCURISEÃÅ, car il permettrait aÃÄ un utilisateur malveillant 
                    // de modifier les points directement depuis le navigateur.
                    
                    // D√©marrer une transaction (pour des raisons de s√©curit√©, ceci est pr√©f√©rable si on doit le faire c√¥t√© client)
                    await db.runTransaction(async (transaction) => {
                        const buyerRef = db.collection('users').doc(buyerId);
                        const contributorRef = db.collection('users').doc(contributorId);
                        
                        const buyerDoc = await transaction.get(buyerRef);
                        
                        if (!buyerDoc.exists) throw "Erreur: Acheteur non trouv√©.";
                        if (buyerDoc.data().points < 2) throw "Erreur: Points insuffisants.";
                        
                        // 1. D√©duire les points de l'acheteur
                        transaction.update(buyerRef, { 
                            points: firebase.firestore.FieldValue.increment(-2)
                        });
                        
                        // 2. Cr√©diter les points au contributeur
                        transaction.update(contributorRef, { 
                            points: firebase.firestore.FieldValue.increment(2) 
                        });
                        
                        // 3. Enregistrer la transaction (pour l'historique et √©viter les doubles paiements)
                        // db.collection('transactions').add({ ... });
                    });
                    
                    // Transaction r√©ussie: ouvrir le corrig√©
                    showToast(`Transaction r√©ussie. -2 points. Vous gagnez en sagesse !`, 'success');
                    window.open(exam.corrigeUrl, '_blank');
                    
                    // Envoyer la notification PUSH au contributeur
                    // (N√©cessite Cloud Functions pour le FCM)

                } catch (error) {
                    showToast(`√âchec de la transaction: ${error}`, 'error');
                    console.error("Erreur de transaction:", error);
                } finally {
                    pendingCorrigeExam = null;
                }
            });


            // =================================================================
            // 5. AFFICHAGE DES √âPREUVES ET LOGIQUE D'INTERACTION (SIMPLIFI√âE)
            // =================================================================

            // Fonction de rendu d'une carte d'√©preuve
            function renderExamCard(doc) {
                const data = doc.data();
                const hasCorrige = data.corrigeUrl && data.corrigeUrl.length > 0;
                
                return `
                    <div class="card glass" data-id="${doc.id}" data-corrige-url="${data.corrigeUrl || ''}" data-contributor-id="${data.contributeurId}">
                        <div class="card-title">${data.titre}</div>
                        <div class="card-meta">
                            <span>${data.matiere}</span>
                            <span>${data.classe}</span>
                        </div>
                        <div class="card-author">Contributeur: ${data.contributeurNom}</div>
                        
                        <div class="card-actions">
                            <i class="fas fa-download action-icon download-exam" title="T√©l√©charger l'√©preuve"></i>
                            <i class="fas fa-heart action-icon toggle-favorite" title="Ajouter aux favoris"></i>
                            
                            ${hasCorrige 
                                ? `<i class="fas fa-file-invoice action-icon view-corrige" title="Voir le corrig√© (co√ªte 2 points)"></i>`
                                : `<i class="fas fa-lock action-icon" style="opacity: 0.3;" title="Corrig√© non disponible"></i>`
                            }
                            
                            <i class="fas fa-share-alt action-icon share-exam" title="Partager avec un ami"></i>
                            
                            ${currentUserData && currentUserData.isAdmin 
                                ? `<i class="fas fa-trash-alt action-icon delete-exam" title="Supprimer (Admin)"></i>`
                                : ''
                            }
                        </div>
                    </div>
                `;
            }

            // √âcoute des √©preuves approuv√©es pour la page d'accueil
            function loadUserDependentData() {
                if (!currentUserData) return;

                // √âcoute de la collection 'epreuves' pour la section 'home' et 'exams'
                db.collection('epreuves').limit(20).orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        const homeCardsContainer = document.getElementById('home-cards');
                        const examsCardsContainer = document.getElementById('exams-cards');
                        let html = '';
                        
                        if (snapshot.empty) {
                            // Afficher les √©tats vides
                            homeCardsContainer.innerHTML = document.querySelector('#home-section .empty-state').outerHTML;
                            examsCardsContainer.innerHTML = document.querySelector('#exams-section .empty-state').outerHTML;
                            return;
                        }

                        snapshot.forEach(doc => {
                            html += renderExamCard(doc);
                        });

                        homeCardsContainer.innerHTML = html;
                        examsCardsContainer.innerHTML = html; // Pour l'instant, m√™me contenu que home
                        attachCardListeners(homeCardsContainer);
                        attachCardListeners(examsCardsContainer);

                    }, error => {
                        console.error("Erreur de chargement des √©preuves:", error);
                        showToast("Erreur de chargement des √©preuves.", 'error');
                    });
                    
                // Logique pour l'admin (soumissions en attente)
                if (currentUserData.isAdmin) {
                    db.collection('soumissions_en_attente').orderBy('createdAt', 'desc')
                        .onSnapshot(snapshot => {
                            document.getElementById('pending-submissions').textContent = snapshot.size;
                            // ... (Rendre la liste des soumissions pour la mod√©ration)
                        });
                }
            }
            
            // Attacher les listeners aux ic√¥nes d'action des cartes
            function attachCardListeners(container) {
                container.querySelectorAll('.view-corrige').forEach(icon => {
                    icon.onclick = (e) => {
                        const card = e.currentTarget.closest('.card');
                        const examData = {
                            corrigeUrl: card.getAttribute('data-corrige-url'),
                            contributeurId: card.getAttribute('data-contributor-id'),
                            id: card.getAttribute('data-id')
                        };
                        handleViewCorrige(examData);
                    };
                });

                container.querySelectorAll('.download-exam').forEach(icon => {
                    icon.onclick = (e) => {
                        // Pour cet exemple, on suppose que l'URL de l'√©preuve est dans Firestore
                        // Normalement, vous devriez chercher l'URL du PDF de l'√©preuve ici
                        showToast("T√©l√©chargement de l'√©preuve lanc√© (simul√©)...", 'info');
                        // window.open(epreuveUrl, '_blank');
                    };
                });
                
                container.querySelectorAll('.toggle-favorite').forEach(icon => {
                    icon.onclick = () => showToast("Fonctionnalit√© Favoris √† impl√©menter...", 'info');
                });
                container.querySelectorAll('.share-exam').forEach(icon => {
                    icon.onclick = () => {
                        document.getElementById('share-modal').style.display = 'flex';
                        showToast("Fonctionnalit√© Partage √† impl√©menter...", 'info');
                    };
                });
                container.querySelectorAll('.delete-exam').forEach(icon => {
                    icon.onclick = () => showToast("Fonctionnalit√© Suppression Admin √† impl√©menter...", 'info');
                });
            }


            // =================================================================
            // 6. INITIALISATION DE L'INTERFACE (Apr√®s le DOMContentLoaded)
            // =================================================================

            // 1. G√©rer le Splash Screen et l'acceptation des CGU
            document.getElementById('accept-cgu').addEventListener('click', function() {
                document.getElementById('warning-modal').style.display = 'none';
                // L'onAuthStateChanged prendra le relais pour afficher la page d'authentification
            });

            // 2. Initialiser les √©v√©nements d'Auth (Login/Register)
            initializeAuthListeners();
            
            // 3. Initialiser la navigation
            document.querySelectorAll('.nav-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${section}-section`).classList.add('active');
                });
            });

            // 4. Initialiser la d√©connexion (utiliser le SDK)
            document.getElementById('logout-btn').addEventListener('click', () => {
                auth.signOut().then(() => {
                    showToast('D√©connexion r√©ussie.', 'info');
                }).catch(error => {
                    showToast(`Erreur de d√©connexion: ${error.message}`, 'error');
                });
            });

            // 5. Initialiser les Modales
            document.getElementById('add-exam-btn').addEventListener('click', () => {
                document.getElementById('add-exam-modal').style.display = 'flex';
            });
            document.getElementById('cancel-add-exam').addEventListener('click', () => {
                document.getElementById('add-exam-modal').style.display = 'none';
                document.getElementById('add-exam-form').reset();
            });
            document.getElementById('cancel-share').addEventListener('click', () => {
                document.getElementById('share-modal').style.display = 'none';
            });

            // 6. Gestion des liens du footer (CGU/Politique)
            document.getElementById('cgu-link').addEventListener('click', function(e) {
                e.preventDefault();
                // Le HTML a d√©j√† le contenu des CGU dans la modale 'warning-modal', on la r√©utilise.
                document.getElementById('warning-modal').style.display = 'flex';
            });
            document.getElementById('privacy-link').addEventListener('click', function(e) {
                e.preventDefault();
                // Le contenu de la politique de confidentialit√© est manquant dans la modale du HTML.
                // Vous devez ajouter une modale sp√©cifique pour la Politique de Conf.
                showToast('Veuillez ajouter le contenu de la Politique de Confidentialit√© dans une modale d√©di√©e.', 'info');
            });
            
            // La gestion de la visibilit√© initiale est d√©l√©gu√©e √† l'onAuthStateChanged

        });
    </script>
</body>
</html>
